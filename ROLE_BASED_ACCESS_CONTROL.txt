# BADMINTON COURT MANAGEMENT SYSTEM - ROLE-BASED ACCESS CONTROL DOCUMENTATION
# Generated: December 7, 2025

## ROLES OVERVIEW

### 1. Admin (Administrator)
- Full system access
- System configuration management
- User and role management
- Highest privilege level

### 2. BranchAdministrator (Branch Administrator)
- Manage branch operations
- View reports and dashboards
- Manage staff within branch
- Access most management functions

### 3. Staff (Office Staff)
- Manage schedules and shifts
- Handle customer information
- Process bookings
- View attendance records

### 4. WarehouseStaff (Warehouse Staff)
- Manage inventory
- Process receipts and stock movements
- Manage products and categories
- Handle supplier information

### 5. Receptionist (Front Desk)
- Manage court bookings
- Handle customer check-in/check-out
- Process orders and payments
- Manage services

### 6. Customer
- View and book courts
- Provide feedback
- Receive notifications
- Manage personal bookings

---

## AUTHORIZATION POLICIES

| Policy Name | Roles Included | Description |
|-------------|----------------|-------------|
| AdminOnly | Admin | System administrators only |
| ManagementOnly | Admin, BranchAdministrator | Management level access |
| StaffAccess | Admin, BranchAdministrator, Staff, Receptionist, WarehouseStaff | All staff members |
| OfficeStaffAccess | Admin, BranchAdministrator, Staff, Receptionist | Office staff operations |
| WarehouseAccess | Admin, BranchAdministrator, WarehouseStaff | Warehouse operations |
| ReceptionistAccess | Admin, BranchAdministrator, Receptionist | Front desk operations |
| CustomerAccess | All authenticated users | All users including customers |
| Authenticated | All authenticated users | Any logged-in user |

---

## CONTROLLERS AND ENDPOINTS ACCESS CONTROL

### 1. ActivitiesController (api/Activity)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- POST /api/Activity/create - Create activity log
- GET /api/Activity/list - List all activities

---

### 2. AttendanceController (api/Attendance)
**Policy:** OfficeStaffAccess
**Access:** Admin, BranchAdministrator, Staff, Receptionist

Endpoints:
- POST /api/Attendance/checkin - Staff check-in
- POST /api/Attendance/checkout - Staff check-out
- POST /api/Attendance - Add attendance record
- GET /api/Attendance - Get attendance records

---

### 3. AuthController (api/Auth)
**Policy:** Mixed (Public + Authenticated)
**Access:** Public for login, Authenticated for user info

Endpoints:
- POST /api/Auth/login - Login (Public)
- GET /api/Auth/me - Get current user (Authenticated)
- POST /api/Auth/register - Register (Public)
- POST /api/Auth/logout - Logout (Authenticated)
- POST /api/Auth/refresh-token - Refresh token (Authenticated)

---

### 4. BlogsController (api/Blogs)
**Policy:** ManagementOnly (with AllowAnonymous on some)
**Access:** Admin, BranchAdministrator (Create/Update/Delete), Public (Read)

Endpoints:
- GET /api/Blogs/list - List blogs (AllowAnonymous)
- GET /api/Blogs/detail - Blog detail (AllowAnonymous)
- POST /api/Blogs/create - Create blog (Management)
- PUT /api/Blogs/update - Update blog (Management)
- DELETE /api/Blogs/delete - Delete blog (Management)

---

### 5. BookingCourtsController (api/BookingCourts)
**Policy:** ReceptionistAccess (Default), Some AllowAnonymous
**Access:** Admin, BranchAdministrator, Receptionist

Endpoints:
- POST /api/BookingCourts/create - Create booking
- GET /api/BookingCourts/list - List bookings
- GET /api/BookingCourts/detail - Booking detail
- PUT /api/BookingCourts/update - Update booking
- DELETE /api/BookingCourts/cancel - Cancel booking
- POST /api/BookingCourts/checkin - Check-in booking
- POST /api/BookingCourts/checkout - Checkout booking

---

### 6. CashflowsController (api/Cashflows)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Cashflows - List cashflows
- GET /api/Cashflows/{id} - Cashflow detail
- POST /api/Cashflows - Create cashflow
- PUT /api/Cashflows/{id} - Update cashflow
- DELETE /api/Cashflows/{id} - Delete cashflow

---

### 7. CategoriesController (api/Categories)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/Categories/list - List categories
- GET /api/Categories/detail - Category detail
- POST /api/Categories/create - Create category
- PUT /api/Categories/update - Update category
- DELETE /api/Categories/delete - Delete category

---

### 8. CourtAreasController (api/CourtAreas)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/CourtAreas/list - List court areas
- GET /api/CourtAreas/detail - Court area detail
- POST /api/CourtAreas/create - Create court area
- PUT /api/CourtAreas/update - Update court area
- DELETE /api/CourtAreas/delete - Delete court area

---

### 9. CourtsController (api/Courts)
**Policy:** ReceptionistAccess (with AllowAnonymous on list)
**Access:** Admin, BranchAdministrator, Receptionist

Endpoints:
- GET /api/Courts/list - List courts (AllowAnonymous)
- GET /api/Courts/detail - Court detail
- POST /api/Courts/create - Create court
- PUT /api/Courts/update - Update court
- DELETE /api/Courts/delete - Delete court
- GET /api/Courts/availability - Check availability

---

### 10. CustomersController (api/Customers)
**Policy:** OfficeStaffAccess
**Access:** Admin, BranchAdministrator, Staff, Receptionist

Endpoints:
- GET /api/Customers/list - List customers
- GET /api/Customers/list-paged - Paged customer list
- GET /api/Customers/detail - Customer detail
- POST /api/Customers/create - Create customer
- PUT /api/Customers/update - Update customer
- DELETE /api/Customers/delete - Delete customer

---

### 11. DashboardController (api/Dashboard)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Dashboard/summary - Dashboard summary
- GET /api/Dashboard/revenue - Revenue statistics
- GET /api/Dashboard/bookings/heatmap - Booking heatmap
- GET /api/Dashboard/top-courts - Top courts
- GET /api/Dashboard/recent-transactions - Recent transactions

---

### 12. DepartmentController (api/Department)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Department - List departments
- GET /api/Department/{id} - Department detail
- POST /api/Department - Create department
- PUT /api/Department/{id} - Update department
- DELETE /api/Department/{id} - Delete department

---

### 13. EmailController (api/Email)
**Policy:** AdminOnly
**Access:** Admin

Endpoints:
- POST /api/Email/test-configuration - Test email configuration

---

### 14. ExportsController (api/Exports)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Exports/booking-history - Export booking history

---

### 15. FeedbacksController (api/Feedbacks)
**Policy:** CustomerAccess
**Access:** All authenticated users

Endpoints:
- POST /api/Feedbacks/create - Create feedback
- GET /api/Feedbacks/detail - Feedback detail
- PUT /api/Feedbacks/update - Update feedback
- DELETE /api/Feedbacks/delete - Delete feedback
- GET /api/Feedbacks/list - List feedbacks

---

### 16. FilesController (api/files)
**Policy:** CustomerAccess
**Access:** All authenticated users

Endpoints:
- POST /api/files/upload - Upload file
- GET /api/files/{filename} - Get file
- DELETE /api/files/{filename} - Delete file

---

### 17. InventoryCardsController (api/InventoryCards)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/InventoryCards/list-by-product - List inventory cards by product
- GET /api/InventoryCards/detail - Inventory card detail
- POST /api/InventoryCards/create - Create inventory card
- PUT /api/InventoryCards/update - Update inventory card

---

### 18. InventoryChecksController (api/InventoryChecks)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/InventoryChecks/list - List inventory checks
- GET /api/InventoryChecks/{id} - Inventory check detail
- POST /api/InventoryChecks - Create inventory check
- PUT /api/InventoryChecks/{id} - Update inventory check
- DELETE /api/InventoryChecks/{id} - Delete inventory check

---

### 19. MembershipsController (api/Memberships)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Memberships/list - List memberships
- GET /api/Memberships/detail - Membership detail
- POST /api/Memberships/create - Create membership
- PUT /api/Memberships/update - Update membership
- DELETE /api/Memberships/delete - Delete membership

---

### 20. NotificationsController (api/Notifications)
**Policy:** CustomerAccess
**Access:** All authenticated users

Endpoints:
- GET /api/Notifications/list - List notifications

---

### 21. OrdersController (api/Orders)
**Policy:** ReceptionistAccess
**Access:** Admin, BranchAdministrator, Receptionist

Endpoints:
- POST /api/Orders/checkout - Checkout order
- GET /api/Orders/{orderId} - Get order by ID
- GET /api/Orders/booking/{bookingId} - Get orders by booking
- PUT /api/Orders/{orderId}/status - Update order status

---

### 22. PaymentsController (api/payment-webhooks)
**Policy:** None (Webhook endpoint)
**Access:** Public (for payment gateway webhooks)

Endpoints:
- POST /api/payment-webhooks/sepay - SePay webhook
- POST /api/payment-webhooks/vnpay - VNPay webhook

---

### 23. PaymentsQueryController (api/PaymentsQuery)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/PaymentsQuery/list - List payments
- GET /api/PaymentsQuery/{id} - Payment detail

---

### 24. PayrollController (api/Payroll)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- POST /api/Payroll - Create payroll
- GET /api/Payroll - List payrolls
- POST /api/Payroll/refresh/{payrollId} - Refresh payroll
- GET /api/Payroll/{id} - Payroll detail
- PUT /api/Payroll/{id} - Update payroll
- DELETE /api/Payroll/{id} - Delete payroll

---

### 25. PricesController (api/Prices)
**Policy:** ReceptionistAccess
**Access:** Admin, BranchAdministrator, Receptionist

Endpoints:
- GET /api/Prices/list - List price tables
- GET /api/Prices/detail - Price table detail
- POST /api/Prices/create - Create price table
- PUT /api/Prices/update - Update price table
- DELETE /api/Prices/delete - Delete price table

---

### 26. ProductsController (api/Products)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/Products/list - List products
- GET /api/Products/detail - Product detail
- POST /api/Products/create - Create product
- PUT /api/Products/update - Update product
- PUT /api/Products/update-status - Update product status
- DELETE /api/Products/delete - Delete product

---

### 27. ReceiptsController (api/Receipts)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/Receipts/list - List receipts
- GET /api/Receipts/detail - Receipt detail
- POST /api/Receipts - Create receipt
- PUT /api/Receipts/{id} - Update receipt
- PUT /api/Receipts/{id}/complete - Complete receipt
- PUT /api/Receipts/{id}/cancel - Cancel receipt
- PUT /api/Receipts/{id}/note - Update receipt note

---

### 28. ReturnGoodsController (api/ReturnGoods)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/ReturnGoods/list - List return goods
- GET /api/ReturnGoods/detail/{id} - Return goods detail
- POST /api/ReturnGoods/create - Create return goods
- PUT /api/ReturnGoods/{id} - Update return goods
- PUT /api/ReturnGoods/{id}/complete - Complete return goods

---

### 29. RolesController (api/Roles)
**Policy:** AdminOnly
**Access:** Admin

Endpoints:
- GET /api/Roles/list - List roles
- GET /api/Roles/detail - Role detail
- POST /api/Roles/create - Create role
- PUT /api/Roles/update - Update role
- DELETE /api/Roles/delete - Delete role

---

### 30. SalaryFormController (api/SalaryForm)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/SalaryForm - List salary forms
- GET /api/SalaryForm/{id} - Salary form detail
- POST /api/SalaryForm - Create salary form
- PUT /api/SalaryForm/{id} - Update salary form
- DELETE /api/SalaryForm/{id} - Delete salary form

---

### 31. ScheduleController (api/Schedule)
**Policy:** OfficeStaffAccess
**Access:** Admin, BranchAdministrator, Staff, Receptionist

Endpoints:
- GET /api/Schedule/by-shift - Get schedule by shift
- GET /api/Schedule/by-staff - Get schedule by staff
- POST /api/Schedule - Create schedule
- PUT /api/Schedule/{id} - Update schedule
- DELETE /api/Schedule/{id} - Delete schedule

---

### 32. ServicesController (api/Services)
**Policy:** ReceptionistAccess
**Access:** Admin, BranchAdministrator, Receptionist

Endpoints:
- GET /api/Services/list - List services
- GET /api/Services/detail - Service detail
- POST /api/Services/create - Create service
- PUT /api/Services/update - Update service
- DELETE /api/Services/delete - Delete service
- PUT /api/Services/update-status - Update service status

---

### 33. ShiftController (api/Shift)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Shift - List shifts
- GET /api/Shift/{id} - Shift detail
- POST /api/Shift - Create shift
- PUT /api/Shift/{id} - Update shift
- DELETE /api/Shift/{id} - Delete shift

---

### 34. SlidersController (api/Sliders)
**Policy:** ManagementOnly (with AllowAnonymous on users/list)
**Access:** Admin, BranchAdministrator (Manage), Public (View)

Endpoints:
- GET /api/Sliders/list - List sliders (Management)
- GET /api/Sliders/users/list - List sliders for users (AllowAnonymous)
- GET /api/Sliders/detail - Slider detail
- POST /api/Sliders/create - Create slider
- PUT /api/Sliders/update - Update slider
- DELETE /api/Sliders/delete - Delete slider

---

### 35. StaffController (api/Staff)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Staff - List staff
- GET /api/Staff/{id} - Staff detail
- POST /api/Staff - Create staff
- PUT /api/Staff/{id} - Update staff
- DELETE /api/Staff/{id} - Delete staff

---

### 36. StockOutsController (api/StockOuts)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/StockOuts/list - List stock outs
- GET /api/StockOuts/detail/{id} - Stock out detail
- POST /api/StockOuts/create - Create stock out
- PUT /api/StockOuts/{id} - Update stock out
- PUT /api/StockOuts/{id}/complete - Complete stock out

---

### 37. StoreBankAccountsController (api/store-bank-accounts)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/store-bank-accounts - List store bank accounts
- POST /api/store-bank-accounts - Create bank account
- PUT /api/store-bank-accounts/{id} - Update bank account
- DELETE /api/store-bank-accounts/{id} - Delete bank account

---

### 38. SupplierBankAccountsController (api/SupplierBankAccounts)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/SupplierBankAccounts/list - List supplier bank accounts
- POST /api/SupplierBankAccounts - Create supplier bank account
- PUT /api/SupplierBankAccounts/{id} - Update supplier bank account
- DELETE /api/SupplierBankAccounts/{id} - Delete supplier bank account

---

### 39. SuppliersController (api/Suppliers)
**Policy:** WarehouseAccess
**Access:** Admin, BranchAdministrator, WarehouseStaff

Endpoints:
- GET /api/Suppliers/list - List suppliers
- GET /api/Suppliers/detail - Supplier detail
- POST /api/Suppliers/create - Create supplier
- PUT /api/Suppliers/update - Update supplier
- DELETE /api/Suppliers/delete - Delete supplier

---

### 40. SystemConfigController (api/SystemConfig)
**Policy:** AdminOnly
**Access:** Admin

Endpoints:
- GET /api/SystemConfig/{key} - Get config by key
- GET /api/SystemConfig/group/{group} - Get configs by group
- POST /api/SystemConfig - Create config
- PUT /api/SystemConfig/{key} - Update config

---

### 41. UserMembershipsController (api/UserMemberships)
**Policy:** OfficeStaffAccess
**Access:** Admin, BranchAdministrator, Staff, Receptionist

Endpoints:
- GET /api/UserMemberships/list - List user memberships
- GET /api/UserMemberships/detail - User membership detail
- POST /api/UserMemberships/create - Create user membership
- PUT /api/UserMemberships/update - Update user membership
- DELETE /api/UserMemberships/delete - Delete user membership

---

### 42. UsersController (api/Users)
**Policy:** AdminOnly
**Access:** Admin

Endpoints:
- POST /api/Users/change-user-status - Change user status
- GET /api/Users/list-administrator - List administrators
- POST /api/Users/create-administrator - Create administrator
- PUT /api/Users/update-administrator - Update administrator

---

### 43. VouchersController (api/Vouchers)
**Policy:** ManagementOnly
**Access:** Admin, BranchAdministrator

Endpoints:
- GET /api/Vouchers/list - List vouchers
- GET /api/Vouchers/detail - Voucher detail
- POST /api/Vouchers/create - Create voucher
- PUT /api/Vouchers/update - Update voucher
- DELETE /api/Vouchers/delete - Delete voucher
- GET /api/Vouchers/validate - Validate voucher
- POST /api/Vouchers/apply - Apply voucher

---

## SUMMARY BY ROLE

### Admin
- Full access to all endpoints
- Exclusive access to: SystemConfig, Users, Roles, Email testing

### BranchAdministrator
- Access to all management functions
- Cannot access: SystemConfig, Users, Roles management
- Full access to: Dashboard, Reports, Staff management, Financial operations

### Staff (Office Staff)
- Customer management
- Schedule and attendance viewing
- User membership management
- Limited booking operations

### WarehouseStaff
- Full warehouse operations
- Inventory management
- Product and category management
- Supplier management
- Receipt and stock movement operations

### Receptionist
- Court and booking management
- Order processing
- Service management
- Price table viewing
- Customer check-in/check-out

### Customer
- View courts and services
- Create bookings
- Provide feedback
- Upload files
- Receive notifications
- View personal booking history

---

## IMPLEMENTATION NOTES

1. All authorization policies are defined in `ApiApplication/Authorization/PolicyConstants.cs`
2. Policies are registered in `Program.cs` using `AddAuthorization()`
3. Each controller is decorated with `[Authorize(Policy = PolicyConstants.XxxPolicy)]`
4. Some endpoints use `[AllowAnonymous]` to allow public access (e.g., blog reading, court listing)
5. Migration `AddRoleSystemForBCMS` has been created and applied to seed all 6 roles

---

## NEXT STEPS

1. Test each endpoint with different role users
2. Implement fine-grained permissions at action level if needed
3. Add logging for authorization failures
4. Create admin panel for role assignment
5. Document API using Swagger with role requirements

---

End of Documentation
