# Integration Test Cases - Booking History & Payment Module

## Test Cases Table

| Test Case ID | Test Case Description | Test Case Procedure | Expected Results | Pre-conditions |
|--------------|----------------------|---------------------|------------------|----------------|
| TC-BOOKINGHISTORY-001 | Verify Booking History page UI elements are displayed correctly | 1. Navigate to profile page (/homepage/profile)<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab in the menu<br>3. Verify "Lịch sử đặt sân & Thanh toán" title is displayed<br>4. Verify table with columns: Sân, Ngày đặt, Thời gian, Trạng thái, Tổng tiền, Đã trả, Còn lại, Thao tác<br>5. Verify "Tải lại dữ liệu" button is visible<br>6. Verify "Xuất file Excel" button is visible<br>7. Verify pagination controls are visible | All UI elements are displayed correctly. Table structure is shown with all required columns. Action buttons are visible and properly styled. Pagination controls are displayed at the bottom of the table. | User is logged in |
| TC-BOOKINGHISTORY-002 | Verify booking history data is loaded and displayed correctly | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for booking history data to load<br>4. Verify table displays booking records<br>5. Verify each row shows: court name, booking date (DD/MM/YYYY format), time range (HH:mm - HH:mm), status tag with correct color, total amount (formatted with VN locale), paid amount, remaining amount<br>6. Verify status tags display correct text: "Đã đặt & thanh toán" (green), "Chờ thanh toán" (orange), "Hoàn tất" (blue), "Đã hủy" (red) | Booking history data is loaded successfully. All booking records are displayed in the table. Data is formatted correctly (dates, times, amounts). Status tags show correct colors and text. No loading spinner is shown after data loads. | User is logged in. User has booking history records |
| TC-BOOKINGHISTORY-003 | Verify empty state is displayed when user has no booking history | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for data to load<br>4. Verify empty state is displayed | Empty state component is shown with message "Bạn chưa có lịch sử đặt sân nào". Empty icon is displayed. Table is not shown. Action buttons are still visible. | User is logged in. User has no booking history records |
| TC-BOOKINGHISTORY-004 | Verify expandable row functionality to view booking details | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for booking history to load<br>4. Click on expand icon/row to expand a booking record<br>5. Verify expandable content appears below the row<br>6. Verify two tabs are displayed: "Chi tiết đặt sân" and "Lịch sử thanh toán"<br>7. Click on "Chi tiết đặt sân" tab<br>8. Verify booking details are displayed<br>9. Click on "Lịch sử thanh toán" tab<br>10. Verify payment history is displayed<br>11. Click expand icon again to collapse the row | Row expands successfully. Expandable content shows two tabs with icons. "Chi tiết đặt sân" tab displays booking details. "Lịch sử thanh toán" tab displays payment history. Row can be collapsed by clicking expand icon again. | User is logged in. User has booking history records |
| TC-BOOKINGHISTORY-005 | Verify QR payment button functionality for pending payments | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for booking history to load<br>4. Locate a booking record with status "Chờ thanh toán" (PendingPayment)<br>5. Verify "Mã QR" button is enabled in the Actions column<br>6. Click "Mã QR" button<br>7. Verify QR Payment Drawer opens<br>8. Verify drawer displays payment information and QR code<br>9. Close the drawer | "Mã QR" button is enabled only for bookings with status "PendingPayment" and has qrUrl. Button is disabled for other statuses. Clicking the button opens QR Payment Drawer. Drawer displays payment details and QR code. Drawer can be closed successfully. | User is logged in. User has booking records with "PendingPayment" status and qrUrl |
| TC-BOOKINGHISTORY-006 | Verify QR payment button is disabled for non-pending bookings | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for booking history to load<br>4. Locate booking records with status other than "PendingPayment" (e.g., "Active", "Completed", "Cancelled")<br>5. Verify "Mã QR" button is disabled in the Actions column | "Mã QR" button is disabled for bookings that are not in "PendingPayment" status or do not have qrUrl. Button is not clickable. Tooltip or visual indication shows button is disabled. | User is logged in. User has booking records with various statuses |
| TC-BOOKINGHISTORY-007 | Verify export booking history to Excel functionality | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for booking history to load<br>4. Verify "Xuất file Excel" button is visible<br>5. Click "Xuất file Excel" button<br>6. Wait for export process to complete<br>7. Verify file download is triggered | Export button is clickable. Clicking the button triggers file download. Excel file "booking_history.xlsx" is downloaded. File contains booking history data. Button shows loading state during export process. | User is logged in. User has booking history records. Browser allows file downloads |
| TC-BOOKINGHISTORY-008 | Verify reload data functionality | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for initial data to load<br>4. Make a note of current booking records count or latest booking<br>5. Click "Tải lại dữ liệu" button<br>6. Observe button shows loading state<br>7. Wait for data to reload<br>8. Verify table data is refreshed | Reload button is clickable. Button shows loading spinner during reload. Data is refreshed from server. Table displays updated booking history. Loading state disappears after data loads. | User is logged in. Network connection is available |
| TC-BOOKINGHISTORY-009 | Verify pagination functionality | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for booking history to load<br>4. Verify pagination controls are displayed at bottom of table<br>5. If more than 10 records exist, verify pagination shows multiple pages<br>6. Click on page number 2 (if available)<br>7. Verify table displays records for page 2<br>8. Change page size using page size selector<br>9. Verify table displays correct number of records per page<br>10. Verify pagination shows correct total count | Pagination controls are displayed. Page numbers are clickable. Table updates to show records for selected page. Page size selector allows changing records per page. Total count is displayed correctly in format "X-Y của Z lần đặt sân". Quick jumper allows jumping to specific page. | User is logged in. User has more than 10 booking history records |
| TC-BOOKINGHISTORY-010 | Verify payment amount display and calculation | 1. Navigate to profile page<br>2. Click on "Lịch sử đặt sân & Thanh toán" tab<br>3. Wait for booking history to load<br>4. Verify "Tổng tiền" column displays total amount formatted with VN locale<br>5. Verify "Đã trả" column displays paid amount or "0 đ" if not paid<br>6. Verify "Còn lại" column shows:<br>   - "Chưa tính" if totalAmount is 0<br>   - "Đã thanh toán đủ" (green tag) if remainingAmount is 0<br>   - Remaining amount (warning text) if partially paid<br>   - "Chưa thanh toán" (orange tag) if not paid<br>7. Verify amounts are formatted correctly with thousand separators | Payment amounts are displayed correctly. Total amount shows formatted value or "Chưa tính" if 0. Paid amount shows formatted value or "0 đ". Remaining amount shows correct status tag or formatted value. All amounts use Vietnamese locale formatting (thousand separators). | User is logged in. User has booking history records with various payment statuses |

